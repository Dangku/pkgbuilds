# Maintainer: Jefferson Gonzalez <jgmdev@gmail.com>

pkgname=mali-bifrost-dkms
_pkgbase=mali-bifrost
_pkgdate=202004150401
pkgver=20.0
pkgrel=1
pkgdesc="Mali kernel driver for bifrost hardware in DKMS format."
arch=('aarch64')
url="https://github.com/superna9999/meson_g12a_mali_bifrost"
license=('GPL2')
depends=('dkms' 'bc')
makedepends=('git')
source=(
  "http://ppa.linuxfactory.or.kr/pool/contrib/m/mali-bifrost/mali-bifrost-dkms_${pkgver}-${pkgrel}+${_pkgdate}~focal_arm64.deb"
  "mali_kbase.conf"
  "99-mali.rules"
)
md5sums=(
  '181bdc991162c95ee3d66afb9d815870'
  '5d925319c2135f5b0ceb0b047ee3e0b9'
  '4c12f255dceb052a06f05e926e746f89'
)

prepare() {
  tar -xvJf data.tar.xz
}

package() {
  cd ${srcdir}

  install -d $pkgdir/usr/lib/udev/rules.d/
  install -d ${pkgdir}/etc/modules-load.d/
  install -d ${pkgdir}/usr/src/${_pkgbase}-${pkgver}

  cp 99-mali.rules $pkgdir/usr/lib/udev/rules.d/
  cp mali_kbase.conf ${pkgdir}/etc/modules-load.d/
  cp -pr usr/src/${_pkgbase}-${pkgver}/* ${pkgdir}/usr/src/${_pkgbase}-${pkgver}/
}