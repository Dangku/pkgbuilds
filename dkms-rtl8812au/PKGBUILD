# Maintainer: Jefferson Gonzalez <jgmdev@gmail.com>

pkgname=dkms-rtl8812au
_pkgbase=rtl8812au
_commit=40eafac156c1ce5e736f9767b27dd967a4ae5cbe
pkgver=4.2.2.g${_commit:0:7}
pkgrel=1
pkgdesc="Stable RTL8812AU chipset driver."
arch=('i686' 'x86_64' 'aarch64')
url="https://github.com/gnab/rtl8812au"
license=('GPL2')
depends=('linux' 'linux-headers')
conflicts=("dkms-${_pkgbase}")
source=(
  "https://github.com/gnab/rtl8812au/archive/${_commit}.zip"
  'dkms.conf'
  'rtl8812au.conf'
)
md5sums=(
  '19f23c615a12f9038d49a5aacfffbf6e'
  '7877b5f47f836eae200eb006a1a9474b'
  'fe97a8c0b9f80bcac1f622a36646de29'
)

package() {
  cd ${srcdir}/rtl8812au-$_commit

  install -d ${pkgdir}/etc/modprobe.d

  mkdir -p ${pkgdir}/usr/src/${_pkgbase}-${pkgver}
  cp -pr * ${pkgdir}/usr/src/${_pkgbase}-${pkgver}
  cp ${srcdir}/dkms.conf ${pkgdir}/usr/src/${_pkgbase}-${pkgver}
  cp ${srcdir}/rtl8812au.conf ${pkgdir}/etc/modprobe.d/

  # Set name and version
  sed -e "s/@PKGBASE@/${pkgname}/" \
    -e "s/@PKGVER@/${pkgver}/" \
    -i "${pkgdir}"/usr/src/${_pkgbase}-${pkgver}/dkms.conf
}